## 1. WebSocket 客户端实现

- [x] 1.1 创建 WebSocket 客户端模块 `engine/python_sdk/websocket_client.py`
- [x] 1.2 实现 WebSocket 连接建立和关闭
- [x] 1.3 实现 CONNECT 消息发送（包含 symbols, resolutions, csrf_token, market_type）
- [x] 1.4 实现 CONNECTED 确认消息接收
- [x] 1.5 实现行情数据消息接收和解析
- [x] 1.6 实现自动重连机制（最多重试 3 次，指数退避）
- [x] 1.7 实现连接状态管理（连接中、已连接、断开、重连中）

## 2. 数据缓存实现

- [x] 2.1 创建 `engine/python_sdk/websocket_cache.py` 模块
- [x] 2.2 实现全局数据缓存，按 `(symbol, timeframe)` 组织数据
- [x] 2.3 实现缓存更新接口，支持追加新的 K 线数据
- [x] 2.4 实现缓存查询接口，支持按 symbol 和 timeframe 查询
- [x] 2.5 实现缓存大小限制（最多 1000 根 K 线，避免内存溢出）
- [x] 2.6 实现线程安全的缓存操作（支持并发读写）

## 3. 数据适配器扩展

- [x] 3.1 修改 `ContextDataAdapter.get_history()` 方法，实现混合数据源
- [x] 3.2 优先从 WebSocket 缓存读取数据，如果没有则从 Context 读取
- [x] 3.3 实现数据合并逻辑（WebSocket 数据不足时补充 Context 数据）
- [x] 3.4 保证数据时间顺序和完整性
- [x] 3.5 确保回测场景不受影响（WebSocket 缓存为空时自动回退）

## 4. 配置和订阅管理

- [x] 4.1 实现配置管理（WebSocket 端点、端口、csrf_token、market_type）
- [x] 4.2 支持从配置文件、环境变量读取配置
- [x] 4.3 实现订阅列表配置（系统级配置，策略无需关心）
- [x] 4.4 实现动态订阅管理 API（供策略管理系统使用，可选）
- [x] 4.5 实现错误处理和异常类型定义
- [x] 4.6 实现连接状态查询接口（供系统监控使用）
- [x] 4.7 实现日志记录（连接状态、数据接收、错误等）

## 5. 测试

- [x] 5.1 编写 WebSocket 客户端单元测试 ✅ (11 个测试用例，全部通过)
- [x] 5.2 编写订阅接口单元测试（管理器测试）✅ (12 个测试用例，全部通过)
- [x] 5.3 编写数据适配器集成测试 ✅ (7 个测试用例，全部通过)
- [x] 5.4 编写缓存功能测试 ✅ (6 个测试用例，全部通过)
- [x] 5.5 修复测试问题并验证 ✅ (所有 36 个测试通过)
- [ ] 5.6 编写端到端测试（模拟 WebSocket 服务端）- 待集成阶段
- [ ] 5.7 测试自动重连机制（需要真实连接）- 待集成阶段
- [ ] 5.8 测试多策略并发订阅（需要真实连接）- 待集成阶段

## 6. 文档和示例

- [x] 6.1 更新 `PRD/websocket接入.md`（如果需要）- 已有文档，无需更新
- [x] 6.2 编写策略使用示例代码 - 已创建 `example_websocket_usage.py`
- [x] 6.3 更新 Python SDK 文档 - 已创建 `README.md` 和 `测试说明.md`
- [x] 6.4 添加常见问题解答（FAQ）- 已在 README.md 中包含故障排查部分

