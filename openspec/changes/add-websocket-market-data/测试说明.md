# WebSocket 功能测试说明

## 测试框架

项目使用 **pytest** 作为标准测试框架，所有测试文件都应遵循 pytest 规范。

- ✅ 所有测试文件位于 `tests/` 目录
- ✅ 测试文件命名：`test_*.py`
- ✅ 测试函数命名：`test_*`
- ✅ 使用 pytest fixtures 和断言

## 测试文件说明

### 正式测试文件（使用 pytest）

1. **`tests/test_websocket_cache.py`**
   - WebSocket 缓存功能测试
   - 不依赖外部库，可以直接运行

2. **`tests/test_websocket_client.py`**
   - WebSocket 客户端测试
   - 使用 mock，不依赖实际 WebSocket 连接
   - 需要安装 `websocket-client` 库（用于导入模块）

3. **`tests/test_websocket_manager.py`**
   - WebSocket 管理器测试
   - 使用 mock，测试配置和管理逻辑

4. **`tests/test_websocket_integration.py`**
   - 集成测试
   - 测试数据适配器与 WebSocket 缓存的集成

5. **`tests/test_websocket_mock.py`**
   - Mock 测试
   - 不依赖实际 WebSocket 连接，测试逻辑

### 快速验证脚本（不使用 pytest）

**`test_websocket_simple.py`**
- 快速验证脚本，用于在不安装 pytest 的情况下验证基本功能
- **不是正式测试**，仅用于开发时的快速验证
- 可以独立运行，不依赖 pytest

## 运行测试

### 方式 1：使用虚拟环境（推荐）

```bash
# 激活虚拟环境
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt

# 运行所有 WebSocket 测试
pytest tests/test_websocket_*.py -v

# 运行特定测试文件
pytest tests/test_websocket_cache.py -v
```

### 方式 2：使用系统 Python（不推荐）

```bash
# 安装依赖（可能需要 --user 或 --break-system-packages）
pip install websocket-client pytest

# 运行测试
pytest tests/test_websocket_*.py -v
```

### 方式 3：快速验证（开发时）

```bash
# 运行简单验证脚本（不依赖 pytest）
python3 test_websocket_simple.py
```

## 为什么使用 pytest？

1. **项目标准**：项目已经使用 pytest 作为测试框架
2. **一致性**：所有其他测试文件都使用 pytest（如 `test_data_adapter.py`, `test_context.py` 等）
3. **功能丰富**：pytest 提供 fixtures、参数化、覆盖率等高级功能
4. **CI/CD 友好**：pytest 是标准的 Python 测试框架，易于集成到 CI/CD 流程

## 测试覆盖

### ✅ 已完成的测试

- WebSocket 缓存功能（`test_websocket_cache.py`）
- WebSocket 客户端逻辑（`test_websocket_client.py`，使用 mock）
- WebSocket 管理器（`test_websocket_manager.py`）
- 数据适配器集成（`test_websocket_integration.py`）
- Mock 测试（`test_websocket_mock.py`）

### ⚠️ 需要真实环境的测试

以下测试需要真实的 WebSocket 服务端：

- 端到端连接测试
- 自动重连机制测试
- 多策略并发测试

这些测试可以在集成测试阶段进行。

## 总结

- **正式测试**：使用 pytest，遵循项目规范
- **快速验证**：可以使用 `test_websocket_simple.py`，但不是正式测试
- **所有测试代码**：已经按照 pytest 规范编写，可以直接使用 pytest 运行

