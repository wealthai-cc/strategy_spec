# Tasks: 策略测试后自动打开可视化预览

## 1. 自动预览功能

### 1.1 HTTP 服务器启动
- [ ] 创建 `visualization/preview_server.py` 模块
- [ ] 实现简单的 HTTP 服务器（使用 `http.server`）
- [ ] 支持端口自动检测和选择（8000, 8001, 8002...）
- [ ] 支持后台运行（daemon thread）
- [ ] 编写单元测试

### 1.2 浏览器自动打开
- [ ] 修改 `test_strategy.py` 添加自动预览功能
- [ ] 检测 React 模板是否运行（http://localhost:5173）
- [ ] 启动 HTTP 服务器提供 JSON 文件访问
- [ ] 使用 `webbrowser` 模块打开浏览器
- [ ] 传递 URL 参数自动加载数据：`?data=http://localhost:8000/data.json`
- [ ] 添加 `--no-preview` 参数禁用自动预览
- [ ] 处理不同操作系统的浏览器打开
- [ ] 编写测试验证

### 1.3 错误处理
- [ ] 处理端口被占用的情况
- [ ] 处理浏览器打开失败的情况
- [ ] 处理 React 模板未运行的情况
- [ ] 提供清晰的错误提示和解决方案

## 2. 数据收集增强

### 2.1 框架验证数据收集
- [ ] 修改 `visualization/data_collector.py` 添加框架验证收集
- [ ] 收集已注入函数的可用性（g、log、run_daily 等）
- [ ] 收集 wealthdata API 可用性
- [ ] 收集框架错误信息
- [ ] 保持向后兼容

### 2.2 策略分析数据收集
- [ ] 修改 `visualization/data_collector.py` 添加策略分析收集
- [ ] 收集执行状态（success、partial、failed）
- [ ] 收集订单统计信息
- [ ] 收集数据验证结果
- [ ] 收集警告和错误信息
- [ ] 保持向后兼容

### 2.3 数据导出更新
- [ ] 修改 `visualization/data_exporter.py` 导出框架验证数据
- [ ] 修改 `visualization/data_exporter.py` 导出策略分析数据
- [ ] 更新 JSON Schema
- [ ] 更新 TypeScript 类型定义
- [ ] 保持数据格式版本兼容

## 3. React 组件开发

### 3.1 框架验证面板组件
- [ ] 创建 `src/components/FrameworkVerification.tsx` 组件
- [ ] 显示框架功能列表（g、log、run_daily 等）
- [ ] 使用颜色标记状态（绿色=正常，红色=异常）
- [ ] 显示错误信息（如果有）
- [ ] 响应式布局设计
- [ ] 编写组件测试

### 3.2 策略分析面板组件
- [ ] 创建 `src/components/StrategyAnalysis.tsx` 组件
- [ ] 显示执行状态（成功/失败）
- [ ] 显示订单统计（总数、买入、卖出）
- [ ] 显示数据验证结果
- [ ] 显示警告和错误列表
- [ ] 使用图标和颜色增强可读性
- [ ] 响应式布局设计
- [ ] 编写组件测试

### 3.3 主应用集成
- [ ] 修改 `src/App.tsx` 集成新组件
- [ ] 添加框架验证面板到布局
- [ ] 添加策略分析面板到布局
- [ ] 优化布局和样式
- [ ] 确保数据加载后自动显示

## 4. 类型定义更新

### 4.1 TypeScript 类型
- [ ] 更新 `src/types/data.ts` 添加框架验证类型
- [ ] 更新 `src/types/data.ts` 添加策略分析类型
- [ ] 确保类型与 JSON Schema 一致
- [ ] 导出类型供组件使用

## 5. 测试和文档

### 5.1 端到端测试
- [ ] 测试完整流程：测试策略 → 自动打开预览
- [ ] 测试不同操作系统（macOS、Linux、Windows）
- [ ] 测试端口冲突处理
- [ ] 测试浏览器打开失败处理
- [ ] 测试 React 模板未运行的情况

### 5.2 文档更新
- [ ] 更新 `test_strategy.py` 使用文档
- [ ] 更新 React 模板 README
- [ ] 添加自动预览功能说明
- [ ] 添加故障排除指南

## 6. 优化和增强

### 6.1 用户体验优化
- [ ] 添加加载状态提示
- [ ] 优化错误提示信息
- [ ] 添加键盘快捷键支持（可选）
- [ ] 优化自动加载体验

### 6.2 性能优化
- [ ] HTTP 服务器资源管理
- [ ] 浏览器打开延迟优化
- [ ] 数据加载性能优化

