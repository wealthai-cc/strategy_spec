# Tasks: 添加策略测试可视化前端

## 1. 数据收集和格式化

### 1.1 测试数据收集
- [ ] 在 `test_strategy.py` 中添加数据收集功能
- [ ] 收集K线数据（OHLCV、时间戳）
- [ ] 收集订单操作（买入/卖出、价格、数量、时间）
- [ ] 收集策略函数调用记录（initialize、handle_bar等）
- [ ] 收集框架功能验证结果（函数注入、API调用）

### 1.2 数据格式化
- [ ] 创建数据格式化模块 `visualization/data_formatter.py`
- [ ] 格式化K线数据供图表使用
- [ ] 格式化订单操作数据
- [ ] 格式化策略执行时间线数据
- [ ] 编写单元测试验证数据格式化

## 2. K线图表实现

### 2.1 基础K线图表
- [ ] 创建图表生成模块 `visualization/chart_generator.py`
- [ ] 使用 matplotlib 或 plotly 生成K线图（candlestick）
- [ ] 支持不同市场类型的数据展示（A股、美股、港股、加密货币）
- [ ] 添加时间轴标签
- [ ] 添加价格轴标签
- [ ] 编写单元测试验证图表生成

### 2.2 买卖点标记
- [ ] 在K线图上标记买入点（绿色向上箭头）
- [ ] 在K线图上标记卖出点（红色向下箭头）
- [ ] 添加买卖点标签（显示价格和数量）
- [ ] 处理重叠标记（多个买卖点在同一K线）
- [ ] 编写单元测试验证标记功能

## 3. 交易详情展示

### 3.1 交易详情面板
- [ ] 创建交易详情展示模块 `visualization/trade_details.py`
- [ ] 展示每个交易点的详细信息：
  - 交易时间
  - 交易价格
  - 交易数量
  - 交易方向（买入/卖出）
  - 交易原因（策略逻辑触发条件）
  - 订单状态
- [ ] 支持表格和列表两种展示方式
- [ ] 编写单元测试验证详情展示

### 3.2 交易统计
- [ ] 计算交易统计信息：
  - 总交易次数
  - 买入次数/卖出次数
  - 平均交易价格
  - 总交易金额
- [ ] 展示交易统计面板
- [ ] 编写单元测试验证统计计算

## 4. 策略执行时间线

### 4.1 时间线展示
- [ ] 创建时间线展示模块 `visualization/timeline.py`
- [ ] 展示策略函数的调用顺序：
  - initialize
  - before_trading
  - run_daily 注册的函数
  - handle_bar
  - on_order
- [ ] 显示函数调用时间
- [ ] 显示函数执行结果（成功/失败）
- [ ] 编写单元测试验证时间线生成

## 5. 框架功能验证展示

### 5.1 功能验证面板
- [ ] 创建功能验证展示模块 `visualization/framework_verification.py`
- [ ] 展示已注入的函数列表（g、log、run_daily等）
- [ ] 展示 wealthdata API 调用记录
- [ ] 展示订单操作统计
- [ ] 使用颜色标记（绿色=正常，红色=异常）
- [ ] 编写单元测试验证验证展示

## 6. HTML 报告生成

### 6.1 报告模板
- [ ] 创建 HTML 报告模板
- [ ] 集成K线图表（嵌入 base64 图片或使用 plotly）
- [ ] 集成交易详情面板
- [ ] 集成策略执行时间线
- [ ] 集成框架功能验证面板
- [ ] 添加样式（CSS）

### 6.2 报告生成
- [ ] 创建报告生成模块 `visualization/report_generator.py`
- [ ] 生成完整的 HTML 报告
- [ ] 支持保存到文件
- [ ] 支持在浏览器中打开
- [ ] 编写单元测试验证报告生成

## 7. 集成到测试工具

### 7.1 test_strategy.py 集成
- [ ] 修改 `test_strategy.py` 添加可视化选项
- [ ] 添加命令行参数 `--visualize` 或 `-v`
- [ ] 添加命令行参数 `--output` 指定报告输出路径
- [ ] 保持向后兼容（默认不生成可视化）
- [ ] 编写集成测试

### 7.2 文档更新
- [ ] 更新 `test_strategy.py` 的使用文档
- [ ] 添加可视化报告示例
- [ ] 添加使用说明

## 8. 测试和优化

### 8.1 单元测试
- [ ] 为所有可视化模块编写单元测试
- [ ] 测试覆盖率 > 80%
- [ ] 验证边界情况

### 8.2 集成测试
- [ ] 测试完整流程（从测试执行到报告生成）
- [ ] 测试不同市场类型（A股、美股、港股、加密货币）
- [ ] 测试不同策略类型（run_daily、handle_bar）

### 8.3 性能优化
- [ ] 优化图表生成性能（大数据量）
- [ ] 优化报告生成性能
- [ ] 添加进度提示

