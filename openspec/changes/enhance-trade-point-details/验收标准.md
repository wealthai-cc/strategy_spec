# 验收标准

## 验收目标

验证买卖点详情展示功能是否能够帮助用户快速、准确地判断策略决策的合理性，是否符合策略要求。

## 验收场景

### 场景1: 基础功能验收

#### 1.1 点击买卖点显示详情卡片
**测试步骤**:
1. 打开策略测试可视化页面
2. 在K线图上找到一个买入点标记
3. 点击该买入点标记

**预期结果**:
- ✓ 在买入点标记附近显示详情卡片
- ✓ 卡片不超出图表边界
- ✓ 卡片包含订单基本信息（方向、价格、数量）
- ✓ 卡片包含触发条件信息
- ✓ 卡片包含判断结果（满足/不满足，带颜色编码）

**验收标准**: 所有预期结果都满足

#### 1.2 详情卡片内容完整性
**测试步骤**:
1. 点击一个买入点
2. 检查详情卡片的所有区域

**预期结果**:
- ✓ 订单基本信息区域：显示"买入"、价格、数量
- ✓ 触发条件区域：显示"price > MA5 * 1.01"（或对应的条件）
- ✓ 判断结果区域：显示"✓ 满足"（绿色）或"✗ 不满足"（红色）
- ✓ 实际数据区域：显示当前价格、MA5值、计算后的阈值
- ✓ 技术指标区域：显示MA5等指标值
- ✓ 决策依据区域：显示完整的决策理由
- ✓ 策略状态区域：显示可用资金、持仓等

**验收标准**: 所有区域都有内容，且信息准确

#### 1.3 上下文数据展示
**测试步骤**:
1. 点击一个买卖点
2. 展开上下文数据区域

**预期结果**:
- ✓ 显示前后3根K线的数据（共7根K线）
- ✓ 每根K线显示：时间、开盘、收盘、最高、最低、成交量、MA5
- ✓ 当前K线行高亮显示
- ✓ 数据准确，与K线图上的数据一致

**验收标准**: 数据完整且准确

### 场景2: 决策合理性验证验收

#### 2.1 买入决策合理性验证
**测试步骤**:
1. 找到策略 `double_mean.py` 的一个买入点
2. 点击该买入点
3. 查看详情卡片中的判断结果

**预期结果**:
- ✓ 触发条件显示："price > MA5 * 1.01"
- ✓ 实际数据区域显示：
  - 当前价格：X.XX
  - MA5值：X.XX
  - 阈值（MA5 * 1.01）：X.XX
- ✓ 判断结果：
  - 如果 `当前价格 > 阈值`，显示"✓ 满足"（绿色）
  - 如果 `当前价格 <= 阈值`，显示"✗ 不满足"（红色）
- ✓ 价格关系显示："价格 > MA5 * 1.01 ✓" 或 "价格 <= MA5 * 1.01 ✗"

**验收标准**: 
- 判断结果与实际计算一致
- 颜色编码正确（绿色=满足，红色=不满足）
- 用户能够快速判断该买入决策是否符合策略要求

#### 2.2 卖出决策合理性验证
**测试步骤**:
1. 找到策略 `double_mean.py` 的一个卖出点
2. 点击该卖出点
3. 查看详情卡片中的判断结果

**预期结果**:
- ✓ 触发条件显示："price < MA5"
- ✓ 实际数据区域显示：
  - 当前价格：X.XX
  - MA5值：X.XX
- ✓ 判断结果：
  - 如果 `当前价格 < MA5`，显示"✓ 满足"（绿色）
  - 如果 `当前价格 >= MA5`，显示"✗ 不满足"（红色）
- ✓ 价格关系显示："价格 < MA5 ✓" 或 "价格 >= MA5 ✗"

**验收标准**: 
- 判断结果与实际计算一致
- 颜色编码正确
- 用户能够快速判断该卖出决策是否符合策略要求

#### 2.3 异常情况处理
**测试步骤**:
1. 找到一个判断结果为"不满足"的买卖点
2. 点击查看详情
3. 分析为什么条件不满足但仍执行了订单

**预期结果**:
- ✓ 详情卡片明确显示"✗ 不满足"（红色）
- ✓ 显示实际数据对比（如：价格10.50，阈值10.65，差值-0.15）
- ✓ 决策依据区域说明为什么仍执行订单（如果有）

**验收标准**: 
- 能够清晰识别异常情况
- 提供足够信息帮助用户理解异常原因

### 场景3: 图表聚焦模式验收

#### 3.1 买入点聚焦模式
**测试步骤**:
1. 打开K线图（显示所有指标线：MA5、MA10、MA20、MA30、布林带等）
2. 点击一个买入点

**预期结果**:
- ✓ 非关键指标线隐藏或淡化（MA10、MA20、MA30、布林带等）
- ✓ 只保留MA5线（因为买入条件是 `price > MA5 * 1.01`）
- ✓ 图表上显示"显示全部指标"按钮
- ✓ 详情卡片显示

**验收标准**: 
- 图表聚焦到相关指标
- 视觉干扰减少
- 用户能清晰看到价格与MA5的关系

#### 3.2 卖出点聚焦模式
**测试步骤**:
1. 打开K线图（显示所有指标线）
2. 点击一个卖出点

**预期结果**:
- ✓ 非关键指标线隐藏或淡化
- ✓ 只保留MA5线（因为卖出条件是 `price < MA5`）
- ✓ 图表上显示"显示全部指标"按钮

**验收标准**: 同上

#### 3.3 恢复全部指标
**测试步骤**:
1. 在聚焦模式下，点击"显示全部指标"按钮

**预期结果**:
- ✓ 所有指标线恢复显示
- ✓ 图表退出聚焦模式
- ✓ 详情卡片保持显示（如果之前已打开）

**验收标准**: 能够正确恢复原始状态

### 场景4: 交互体验验收

#### 4.1 卡片定位
**测试步骤**:
1. 点击图表边缘的买卖点（左上角、右上角、左下角、右下角）
2. 观察详情卡片的位置

**预期结果**:
- ✓ 卡片不超出图表边界
- ✓ 卡片自动调整位置（如果标记在边缘，卡片显示在相反方向）
- ✓ 卡片内容完整显示，不被裁剪

**验收标准**: 所有边界情况都能正确处理

#### 4.2 键盘导航
**测试步骤**:
1. 点击一个买卖点，显示详情卡片
2. 按ESC键
3. 再次点击一个买卖点
4. 按左方向键
5. 按右方向键

**预期结果**:
- ✓ 按ESC键关闭详情卡片
- ✓ 按左方向键切换到前一个买卖点（按时间顺序）
- ✓ 按右方向键切换到后一个买卖点（按时间顺序）
- ✓ 切换时详情卡片更新为新买卖点的信息
- ✓ 图表自动跳转到新买卖点的位置

**验收标准**: 键盘导航流畅，功能正确

#### 4.3 多个买卖点切换
**测试步骤**:
1. 点击第一个买入点
2. 使用方向键切换到下一个买入点
3. 继续切换到卖出点

**预期结果**:
- ✓ 能够正确切换不同类型的买卖点（买入↔卖出）
- ✓ 切换时聚焦模式相应调整（买入点只显示MA5，卖出点也只显示MA5）
- ✓ 详情卡片内容正确更新

**验收标准**: 切换流畅，信息准确

### 场景5: 性能验收

#### 5.1 大量买卖点性能
**测试步骤**:
1. 使用包含50+个买卖点的测试数据
2. 点击任意买卖点
3. 使用方向键快速切换多个买卖点

**预期结果**:
- ✓ 详情卡片显示延迟 < 100ms
- ✓ 切换买卖点时响应流畅，无卡顿
- ✓ 图表聚焦模式切换流畅
- ✓ 内存使用正常，无内存泄漏

**验收标准**: 性能满足要求，用户体验流畅

## 验收通过标准

### 必须满足（P0）
- ✓ 所有基础功能验收场景通过
- ✓ 所有决策合理性验证验收场景通过
- ✓ 详情卡片内容完整且准确
- ✓ 判断结果与实际计算一致

### 应该满足（P1）
- ✓ 图表聚焦模式正常工作
- ✓ 上下文数据展示准确
- ✓ 键盘导航功能正常

### 最好满足（P2）
- ✓ 性能优化到位
- ✓ 边界情况处理完善
- ✓ 用户体验流畅

## 验收方式

### 方式1: 手动验收
1. 按照上述验收场景逐一测试
2. 记录每个场景的测试结果
3. 生成验收报告

### 方式2: 自动化验收（可选）
1. 编写端到端测试（E2E）
2. 自动化执行验收场景
3. 生成测试报告

### 方式3: 用户验收测试（UAT）
1. 邀请策略开发者使用新功能
2. 收集反馈
3. 根据反馈调整

## 验收示例

### 示例1: 验证买入决策合理性
```
策略: double_mean.py
买入点时间: 2025-12-18 10:00:00
详情卡片显示:
  - 触发条件: price > MA5 * 1.01
  - 当前价格: 10.65
  - MA5值: 10.50
  - 阈值(MA5 * 1.01): 10.605
  - 判断结果: ✓ 满足 (绿色)
  - 价格关系: 价格 > MA5 * 1.01 ✓

验证: 10.65 > 10.605 ✓ 正确
结论: 该买入决策符合策略要求
```

### 示例2: 验证卖出决策合理性
```
策略: double_mean.py
卖出点时间: 2025-12-19 10:00:00
详情卡片显示:
  - 触发条件: price < MA5
  - 当前价格: 10.30
  - MA5值: 10.50
  - 判断结果: ✓ 满足 (绿色)
  - 价格关系: 价格 < MA5 ✓

验证: 10.30 < 10.50 ✓ 正确
结论: 该卖出决策符合策略要求
```

### 示例3: 识别异常情况
```
策略: double_mean.py
买入点时间: 2025-12-20 10:00:00
详情卡片显示:
  - 触发条件: price > MA5 * 1.01
  - 当前价格: 10.60
  - MA5值: 10.50
  - 阈值(MA5 * 1.01): 10.605
  - 判断结果: ✗ 不满足 (红色)
  - 价格关系: 价格 <= MA5 * 1.01 ✗

验证: 10.60 <= 10.605 ✗ 正确
结论: 该买入决策不符合策略要求，需要进一步调查原因
```

