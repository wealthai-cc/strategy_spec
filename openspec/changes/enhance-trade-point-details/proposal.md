# Change: 增强买卖点详情展示

## Why

当前可视化界面存在以下问题：
1. **信息过载**：K线图上同时显示大量买卖点标记、技术指标线（MA5/10/20/30、布林带等），导致图表拥挤，难以聚焦
2. **决策验证困难**：用户点击买卖点时，无法直观判断该决策是否符合策略要求，需要查看多个面板才能获取完整信息
3. **上下文缺失**：买卖点标记只显示价格和数量，缺少关键决策信息（如触发条件、技术指标值、条件判断结果等）
4. **交互体验不佳**：用户需要点击订单列表或决策列表，然后在右侧面板查看详情，无法直接在图表上快速验证决策合理性

用户希望在点击买卖点时，能够：
- 直接在图表上看到该点的决策详情（不依赖右侧面板）
- 快速判断决策是否符合策略要求（价格与指标的关系、条件是否满足）
- 查看该点附近的数据情况（前后K线的价格和指标变化）

## What Changes

### 核心功能
1. **悬停/点击详情卡片**：
   - 点击或悬停买卖点标记时，在标记附近显示一个紧凑的详情卡片
   - 卡片包含：订单信息、触发条件、技术指标值、条件判断结果、决策依据
   - 卡片采用半透明背景，不遮挡图表内容

2. **上下文数据展示**：
   - 在详情卡片中显示该K线的前后N根K线的关键数据（价格、指标值）
   - 使用表格或列表形式展示，便于对比分析

3. **决策合理性可视化**：
   - 在详情卡片中突出显示条件判断结果（满足/不满足）
   - 使用颜色编码（绿色=满足，红色=不满足）
   - 显示价格与关键指标的关系（如：价格 > MA5 * 1.01 ✓）

4. **图表聚焦模式**：
   - 点击买卖点时，自动隐藏/淡化非关键的技术指标线
   - 只保留与该决策相关的指标线（如买入决策只显示MA5）
   - 提供"恢复全部"按钮

### 技术实现
- 使用 ECharts 的 `tooltip` 或自定义 `graphic` 组件实现详情卡片
- 卡片位置智能定位（避免超出图表边界）
- 支持键盘导航（ESC关闭，方向键切换买卖点）

## Impact

- **Affected specs**: 
  - 需要新增 `strategy-visualization` capability（如果不存在）
  - 或修改现有的可视化相关spec

- **Affected code**:
  - `visualization/react-template/src/components/KLineChartECharts.tsx` - 添加详情卡片组件
  - `visualization/react-template/src/types/data.ts` - 可能需要扩展数据类型
  - `visualization/data_collector.py` - 确保决策信息完整收集

- **User experience**:
  - 显著提升决策验证效率
  - 减少在多个面板间切换的操作
  - 更直观地理解策略执行逻辑

## 验收方式

详细的验收标准和验收场景请参考 `验收标准.md` 文件。

### 核心验收点
1. **决策合理性验证**：用户能够快速判断每个买卖点是否符合策略要求
   - 买入点：验证 `price > MA5 * 1.01` 是否满足
   - 卖出点：验证 `price < MA5` 是否满足
   - 通过颜色编码（绿色=满足，红色=不满足）直观展示

2. **信息完整性**：详情卡片包含足够信息，无需查看其他面板即可完成验证

3. **交互体验**：操作流畅，信息清晰，不遮挡关键图表内容

4. **性能表现**：大量买卖点情况下仍能流畅交互

